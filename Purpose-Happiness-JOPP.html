<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick E. McKnight">
<meta name="author" content="Todd B. Kashdan">
<meta name="author" content="Amie MacKay">
<meta name="keywords" content="purpose in life, happiness, well-being, stability, measurement">
<meta name="description" content="PURPOSE AND HAPPINESS">

<title>Purpose and Happiness</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Purpose-Happiness-JOPP_files/libs/clipboard/clipboard.min.js"></script>
<script src="Purpose-Happiness-JOPP_files/libs/quarto-html/quarto.js"></script>
<script src="Purpose-Happiness-JOPP_files/libs/quarto-html/popper.min.js"></script>
<script src="Purpose-Happiness-JOPP_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="Purpose-Happiness-JOPP_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Purpose-Happiness-JOPP_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Purpose-Happiness-JOPP_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Purpose-Happiness-JOPP_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Purpose-Happiness-JOPP_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Purpose-Happiness-JOPP_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Purpose-Happiness-JOPP_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="_extensions/wjschne/apaquarto/apa.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#methods" id="toc-methods" class="nav-link active" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#participants-and-procedure" id="toc-participants-and-procedure" class="nav-link" data-scroll-target="#participants-and-procedure">Participants and Procedure</a>
  <ul class="collapse">
  <li><a href="#purpose" id="toc-purpose" class="nav-link" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#happiness" id="toc-happiness" class="nav-link" data-scroll-target="#happiness">Happiness</a></li>
  </ul></li>
  <li><a href="#data-analytic-approach" id="toc-data-analytic-approach" class="nav-link" data-scroll-target="#data-analytic-approach">Data Analytic Approach</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#assumption-1-comparable-psychometric-properties" id="toc-assumption-1-comparable-psychometric-properties" class="nav-link" data-scroll-target="#assumption-1-comparable-psychometric-properties">Assumption 1: Comparable Psychometric Properties</a></li>
  <li><a href="#assumption-2-do-the-factors-show-evidence-of-factorial-invariance" id="toc-assumption-2-do-the-factors-show-evidence-of-factorial-invariance" class="nav-link" data-scroll-target="#assumption-2-do-the-factors-show-evidence-of-factorial-invariance">Assumption 2: Do The Factors Show Evidence of Factorial Invariance?</a></li>
  </ul></li>
  <li><a href="#final-analysis-what-is-temporal-relationship-between-happiness-and-purpose" id="toc-final-analysis-what-is-temporal-relationship-between-happiness-and-purpose" class="nav-link" data-scroll-target="#final-analysis-what-is-temporal-relationship-between-happiness-and-purpose">Final Analysis: What is Temporal Relationship between Happiness and Purpose?</a></li>
  <li><a href="#analysis-3-cross-lagged-panel-analysis-causal-direction" id="toc-analysis-3-cross-lagged-panel-analysis-causal-direction" class="nav-link" data-scroll-target="#analysis-3-cross-lagged-panel-analysis-causal-direction">Analysis 3: Cross-lagged Panel Analysis (Causal Direction)</a></li>
  <li><a href="#save-for-later" id="toc-save-for-later" class="nav-link" data-scroll-target="#save-for-later">SAVE FOR LATER</a></li>
  <li><a href="#analysis-4-quantile-regression-deeper-look-into-the-relationship" id="toc-analysis-4-quantile-regression-deeper-look-into-the-relationship" class="nav-link" data-scroll-target="#analysis-4-quantile-regression-deeper-look-into-the-relationship">Analysis 4: Quantile Regression (Deeper Look into the Relationship)</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Purpose-Happiness-JOPP.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="Purpose-Happiness-JOPP.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="Purpose-Happiness-JOPP.docx"><i class="bi bi-file-word"></i>MS Word (apaquarto)</a></li><li><a href="Purpose-Happiness-JOPP.pdf"><i class="bi bi-file-pdf"></i>PDF (apaquarto)</a></li><li><a href="Purpose-Happiness-JOPP.pdf"><i class="bi bi-file-pdf"></i>Typst (apaquarto)</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">




<br>

<br>

<section id="title" class="level1 title unnumbered unlisted">
<h1 class="title unnumbered unlisted">Purpose and Happiness: Reliably Related Constructs Over Time</h1>
<div class="Author">
<br>

<p>Patrick E. McKnight, Todd B. Kashdan, and Amie MacKay</p>
<p>Department of Psychology, George Mason University</p>
</div>
<br>

<br>

</section>
<section id="author-note" class="level1 unnumbered unlisted AuthorNote">
<h1 class="unnumbered unlisted AuthorNote">Author Note</h1>
<p>Patrick E. McKnight <img src="_extensions/wjschne/apaquarto/ORCID-iD_icon-vector.svg" id="orchid" class="img-fluid" style="width:4.23mm" alt="Orcid ID Logo: A green circle with white letters ID"> <a href="https://orcid.org/0000-0002-9067-9066">https://orcid.org/0000-0002-9067-9066</a></p>
<p>Todd B. Kashdan <img src="_extensions/wjschne/apaquarto/ORCID-iD_icon-vector.svg" id="orchid" class="img-fluid" style="width:4.23mm" alt="Orcid ID Logo: A green circle with white letters ID"> <a href="https://orcid.org/0000-0001-6438-0485">https://orcid.org/0000-0001-6438-0485</a></p>
<p>Correspondence concerning this article should be addressed to Patrick E. McKnight, Department of Psychology, George Mason University, Email: <a href="mailto:pmcknigh@gmu.edu">pmcknigh@gmu.edu</a></p>
<br>
</section>
<section id="abstract" class="level1 unnumbered unlisted AuthorNote">
<h1 class="unnumbered unlisted AuthorNote">Abstract</h1>
<div class="AbstractFirstParagraph">
<p>Despite widespread assumptions among social scientists about the distinct nature of purpose in life and happiness, limited empirical studies have directly compared these constructs—particularly regarding their stability and their interrelationship over time. This research study addresses these omissions and provides a benchmark for evaluating the bivariate relationship between important constructs in positive psychology. We used psychometrically sound assessments to measure these two constructs. Our findings were clear and reproducible; both purpose and happiness measures produce stable estimates over time and maintain a consistent, moderate correlation (<span class="math inline">rs &gt; .43; p &lt; .001</span>). In longitudinal analyses, the causal direction favors happiness predicting subsequent ratings of purpose rather than the alternative (<span class="math inline">r \approx 0.15</span> vs.&nbsp;<span class="math inline">r \approx −0.04</span>). We address the implications of these findings, provide researchers with guidance on improving the measurement of these fundamental dimensions of well-being, and suggest promising future research directions.</p>
</div>
<p><em>Keywords</em>: purpose in life, happiness, well-being, stability, measurement</p>
<br>
</section>
<section id="firstheader" class="level1 title unnumbered unlisted">
<h1 class="title unnumbered unlisted">Purpose and Happiness: Reliably Related Constructs Over Time</h1>
<p>Happiness and purpose in life are central constructs in well-being models and empirical studies <span class="citation" data-cites="kern2015multidimensional walters2010 rottenberg2022well ryff1995psychological vanderweele2017promotion">(e.g., <a href="#ref-kern2015multidimensional" role="doc-biblioref">Kern et al., 2015</a>; <a href="#ref-rottenberg2022well" role="doc-biblioref">Rottenberg &amp; Kashdan, 2022</a>; <a href="#ref-ryff1995psychological" role="doc-biblioref">Ryff, 1995</a>; <a href="#ref-vanderweele2017promotion" role="doc-biblioref">VanderWeele, 2017</a>; <a href="#ref-walters2010" role="doc-biblioref">Walters, 2010</a>)</span>. Each is characterized by a favorable subjective component, where a person’s thoughts and feelings tend to be more pleasant, or positively inclined above neutral <span class="citation" data-cites="kashdan2024purpose vittterso2025happiness">(e.g., <a href="#ref-kashdan2024purpose" role="doc-biblioref">Kashdan et al., 2024</a>; <a href="#ref-vittterso2025happiness" role="doc-biblioref">Vittersø, 2025</a>)</span> . Both are linked to a variety of healthy psychological, biological, and social outcomes <span class="citation" data-cites="choi2023happiness pfund2018multifaceted">(e.g., <a href="#ref-choi2023happiness" role="doc-biblioref">Choi et al., 2023</a>; <a href="#ref-pfund2018multifaceted" role="doc-biblioref">Pfund &amp; Hill, 2018</a>)</span>. Both are also widely recognized as primary factors that directly influence and shape our actions, decisions, and quality of life <span class="citation" data-cites="kim2019sense veenhoven2008healthy">(e.g., <a href="#ref-kim2019sense" role="doc-biblioref">E. S. Kim et al., 2019</a>; <a href="#ref-veenhoven2008healthy" role="doc-biblioref">Veenhoven, 2008</a>)</span>. However, questions remain as to how these two constructs compare to each other. In this research program, we examined the psychometrics and stability of happiness and purpose over time. Specifically, we sought to understand the magnitude of their association and whether any changes over months and years occur independently of the other. This included whether happiness influences purpose, purpose influences happiness, or if there is evidence of bi-directionality. These issues cannot be explored with a cross-sectional study. As such, we collected data from four assessment periods over two years.</p>
<section id="defining-happiness-and-purpose" class="level2">
<h2 data-anchor-id="defining-happiness-and-purpose">Defining Happiness and Purpose</h2>
<p>In the most widely used model <span class="citation" data-cites="diener1984subjective">(<a href="#ref-diener1984subjective" role="doc-biblioref">Diener, 1984</a>)</span>, happiness is referred to as subjective well-being (SWB) and defined by the presence of three elements: frequent positive emotional experiences, infrequent negative emotional experiences, and a cognitive judgment that life is highly satisfying <span class="citation" data-cites="busseri2011review jovanovic2024cross vittterso2025happiness">(e.g., <a href="#ref-busseri2011review" role="doc-biblioref">Busseri &amp; Sadava, 2011</a>; <a href="#ref-jovanovic2024cross" role="doc-biblioref">Jovanović et al., 2024</a>; <a href="#ref-vittterso2025happiness" role="doc-biblioref">Vittersø, 2025</a>)</span>. Although different models exist that vary in their treatment and conceptualization of these elements– for example, as components of a hierarchical construct, parts of a causal system, or a composite variable – the majority consider all three to be essential for understanding SWB as a whole <span class="citation" data-cites="busseri2011review">(<a href="#ref-busseri2011review" role="doc-biblioref">Busseri &amp; Sadava, 2011</a>)</span>.</p>
<p>Both classic and modern definitions of happiness converge on the notion that happiness is fundamentally a global evaluation of one’s life <span class="citation" data-cites="andrews1980measures diener2006guidelines medvedev2018exploring">(e.g., <a href="#ref-andrews1980measures" role="doc-biblioref">Andrews &amp; McKennell, 1980</a>; <a href="#ref-diener2006guidelines" role="doc-biblioref">Diener, 2006</a>; <a href="#ref-medvedev2018exploring" role="doc-biblioref">Medvedev &amp; Landhuis, 2018</a>)</span>. Rather than merely tallying various factors like emotional states or life experiences, happiness relies on an intuitive, subjective evaluation of one’s overall life. This perspective aligns with a body of research indicating that even major life factors– such as socioeconomic or health status– have surprisingly limited effects on reported happiness <span class="citation" data-cites="sheldon2007possible">(<a href="#ref-sheldon2007possible" role="doc-biblioref">Sheldon &amp; Lyubomirsky, 2007</a>)</span>; a happy life, it seems, is greater than the sum of its parts. Indeed, happiness is sometimes conceptualized as an individual difference factor or trait, underscoring the high level of independence from many external influences; however, certain major life events do consistently alter happiness over the years (e.g., unemployment, personal health issues; <span class="citation" data-cites="lucas2007adaptation">(<a href="#ref-lucas2007adaptation" role="doc-biblioref">Lucas, 2007</a>)</span>)</p>
<p>Since purpose has been explored as a psychological construct <span class="citation" data-cites="frankl1959mans">(<a href="#ref-frankl1959mans" role="doc-biblioref">Frankl, 1959</a>)</span>, several definitions have emerged, of which four are frequently cited. First, Ryff <span class="citation" data-cites="ryff1989happiness">(<a href="#ref-ryff1989happiness" role="doc-biblioref">1989</a>)</span> stated that a person with a sense of purpose “has goals in life and a sense of directedness; feels there is meaning to present and past life; holds beliefs that give life purpose; has aims and objectives for living” (p.&nbsp;45). Second, Damon et al. <span class="citation" data-cites="damon2003development">(<a href="#ref-damon2003development" role="doc-biblioref">2003</a>)</span> described purpose as “a stable and generalized intention to accomplish something that is at once meaningful to the self and of consequence to the world beyond the self” (p.&nbsp;121). Third, Kosine and colleagues <span class="citation" data-cites="kosine2008purpose">(<a href="#ref-kosine2008purpose" role="doc-biblioref">2008</a>)</span> defined purpose as the “identification of highly valued, overarching goals, the attainment of which is anticipated to move people closer to achieving their true potential and bring them deep fulfillment’ (p.&nbsp;133). Fourth, McKnight and Kashdan <span class="citation" data-cites="mcknight2009purpose">(<a href="#ref-mcknight2009purpose" role="doc-biblioref">2009b</a>)</span> considered purpose to be a”central, self-organizing life aim that organizes and stimulates goals, manages behaviors, and provides a sense of meaning” (p.&nbsp;242).</p>
<p>Efforts to synthesize definitions identify three overlapping elements: centrality, goal-directedness, and commitment. Centrality refers to how purpose-related values, beliefs, and behaviors define a person’s sense of self and who they are becoming. Goal-directedness refers to actions aimed at future desired outcomes. Commitment entails the regular expenditure of resources (time, energy, finances, social capital) and decision-making concerning these desired outcomes. Prosocial intentions are another element that is often viewed as essential to purpose <span class="citation" data-cites="damon2003development">(e.g., <a href="#ref-damon2003development" role="doc-biblioref">Damon et al., 2003</a>)</span>; however, it remains unclear if prosocial intentions are a feature or a common descriptor of particular types of purposes or particular individuals with a purpose <span class="citation" data-cites="hill2010sense kashdan2024purpose">(e.g., <a href="#ref-hill2010sense" role="doc-biblioref">Hill et al., 2010</a>; <a href="#ref-kashdan2024purpose" role="doc-biblioref">Kashdan et al., 2024</a>)</span>. Indeed, a person can possess a strong purpose by simply holding a worldview and dedicating behaviors towards ends that matter greatly, which may or may not include caring for others.</p>
<p>Clear differences are apparent in current definitions of happiness and purpose. For happiness, the focus is on felt experiences and thoughts about one’s life <span class="citation" data-cites="vittterso2025happiness">(<a href="#ref-vittterso2025happiness" role="doc-biblioref">Vittersø, 2025</a>)</span>. For purpose, the central focus is goal-setting and meaningful engagement with the world. These purpose features are excluded from quantifiable definitions of subjective <span class="citation" data-cites="diener2009prosperity">(<a href="#ref-diener2009prosperity" role="doc-biblioref">Diener et al., 2009</a>)</span> or objective <span class="citation" data-cites="kahneman1999well">(<a href="#ref-kahneman1999well" role="doc-biblioref">Kahneman et al., 1999</a>)</span> happiness. As such, while these constructs should be related– as they reflect pleasant states of being, thinking, and doing– happiness and purpose appear somewhat independent. The amount of relative independence is an empirical question.</p>
</section>
<section id="measurement-of-happiness-and-purpose" class="level2">
<h2 data-anchor-id="measurement-of-happiness-and-purpose">Measurement of Happiness and Purpose</h2>
<p>Precise, high-quality measurement is essential for advancing the understanding of happiness and purpose. To effectively capture the essence of dominant conceptual models, the present study employed the Subjective Happiness Scale <span class="citation" data-cites="lyubomirsky1999measure">(<a href="#ref-lyubomirsky1999measure" role="doc-biblioref">Lyubomirsky &amp; Lepper, 1999</a>)</span> and the Brief Measure of Purpose in Life <span class="citation" data-cites="hill2016assessing">(<a href="#ref-hill2016assessing" role="doc-biblioref">Hill et al., 2016</a>)</span>, two concise, targeted instruments for capturing happiness and purpose, respectively.</p>
<p>In alignment with theoretical models that define happiness as a global, subjective assessment of one’s life, the Subjective Happiness Scale (SHS) employs a single-factor approach that captures happiness from the individual’s perspective. Participants are given the freedom to interpret happiness on their terms, avoiding the artificial separation of emotional elements (hedonic happiness) from cognitive life assessments (eudaimonic happiness) that has limited previous research (for criticism on this distinction, <span class="citation" data-cites="kashdan2008reconsidering coyne2013highly">(<a href="#ref-coyne2013highly" role="doc-biblioref">Coyne, 2013</a>; see <a href="#ref-kashdan2008reconsidering" role="doc-biblioref">Kashdan et al., 2008</a>)</span>. The brevity of the 4-item scale makes it suitable for longitudinal studies that involve repeated assessments over time, without the risk of imposing survey fatigue on participants. Since its development over 25 years ago, the SHS has been cited over 6,000 times and has demonstrated strong cross-cultural reliability and validity across different groups <span class="citation" data-cites="zager2022measurement">(e.g., <a href="#ref-zager2022measurement" role="doc-biblioref">Zager Kocjan et al., 2022</a>)</span>, while also showing discriminant validity from other facets of well-being <span class="citation" data-cites="extremera2011trait yue2014humor">(e.g., <a href="#ref-extremera2011trait" role="doc-biblioref">Extremera et al., 2011</a>; <a href="#ref-yue2014humor" role="doc-biblioref">Yue et al., 2014</a>)</span>. The widespread adoption of this scale allows findings from the current work to inform a large body of research on happiness.</p>
<p>The Brief Measure of Purpose in Life similarly provides a well-validated, short-form assessment of purpose that captures the core elements of purpose derived from both lay and expert definitions. The scale also maintains the brevity essential for longitudinal study designs. Scale items capture cognitive and motivational aspects of purpose, reflecting conceptual models of purpose as a clear awareness of what someone values and is working toward in their life <span class="citation" data-cites="kashdan2024purpose mcknight2009">(<a href="#ref-kashdan2024purpose" role="doc-biblioref">Kashdan et al., 2024</a>; <a href="#ref-mcknight2009" role="doc-biblioref">McKnight &amp; Kashdan, 2009a</a>)</span>. Like the SHS, the BMPIL has demonstrated excellent cross-cultural validity <span class="citation" data-cites="thalmayer2024lifespan">(e.g., <a href="#ref-thalmayer2024lifespan" role="doc-biblioref">Thalmayer et al., 2024</a>)</span> and has been used in large longitudinal investigations of well-being throughout the lifespan <span class="citation" data-cites="hill2019parent">(e.g., <a href="#ref-hill2019parent" role="doc-biblioref">Hill et al., 2019</a>)</span>.</p>
</section>
<section id="links-between-happiness-and-purpose" class="level2">
<h2 data-anchor-id="links-between-happiness-and-purpose">Links Between Happiness and Purpose</h2>
<p>At the broadest level, well-being is described as “the experience of personally valued fulfillment within one’s life” <span class="citation" data-cites="disabato2025wellbeing">(<a href="#ref-disabato2025wellbeing" role="doc-biblioref">Disabato et al., 2025</a>)</span>. However, well-being is a multifaceted construct with no singular metric capturing its full scope. A comprehensive literature review identified 155 measures of positive mental health reflecting 410 dimensions <span class="citation" data-cites="iasiello2024map">(<a href="#ref-iasiello2024map" role="doc-biblioref">Iasiello et al., 2024</a>)</span>, underscoring the complexity of the construct. Purpose does not require the pursuit of happiness or satisfaction, yet it frequently correlates with both. The presence of a purpose in life has been shown to explain 12-46% of the variance in happiness <span class="citation" data-cites="robak2000purpose aghababaei2014does crego2021meaning">(<a href="#ref-aghababaei2014does" role="doc-biblioref">Aghababaei &amp; Błachnio, 2014</a>; <a href="#ref-crego2021meaning" role="doc-biblioref">Crego et al., 2021</a>; <a href="#ref-robak2000purpose" role="doc-biblioref">Robak &amp; Griffin, 2000</a>)</span> and 11-44% of the variance in life satisfaction <span class="citation" data-cites="bronk2009purpose kim2017associations">(<a href="#ref-bronk2009purpose" role="doc-biblioref">Cotton Bronk et al., 2009</a>; <a href="#ref-kim2017associations" role="doc-biblioref">J. Kim et al., 2017</a>)</span>. Additionally, purpose predicts longitudinal increases in life satisfaction over 18 months <span class="citation" data-cites="chen2020role">(<a href="#ref-chen2020role" role="doc-biblioref">Chen &amp; Cheng, 2020</a>)</span>.</p>
<p>Whereas happiness is defined by fewer, less intense, less enduring unpleasant states and more frequent, intense, and/or enduring pleasant states, purpose is expected to have weaker relationships with emotional states. Individuals with a strong purpose allocate resources more efficiently, enabling them to view stressful events as more of a challenge and less of a threat, consequently lessening emotional strain. Individuals with a strong sense of purpose are better able to continue pursuing their ultimate concerns regardless of transient emotional states, demonstrating a greater capacity for distress tolerance <span class="citation" data-cites="hill2024beating kashdan2024purpose mcknight2009">(<a href="#ref-hill2024beating" role="doc-biblioref">Hill et al., 2024</a>; <a href="#ref-kashdan2024purpose" role="doc-biblioref">Kashdan et al., 2024</a>; <a href="#ref-mcknight2009" role="doc-biblioref">McKnight &amp; Kashdan, 2009a</a>)</span>. This is supported by research showing that individuals with higher purpose experience lower cortisol responses to stress <span class="citation" data-cites="fogelman2015role">(<a href="#ref-fogelman2015role" role="doc-biblioref">Fogelman &amp; Canli, 2015</a>)</span>, diminished negative emotional reactivity to daily stressors <span class="citation" data-cites="hill2018sense">(<a href="#ref-hill2018sense" role="doc-biblioref">Hill et al., 2018</a>)</span>, and attenuated startle responses to negative stimuli <span class="citation" data-cites="schaefer2013purpose">(<a href="#ref-schaefer2013purpose" role="doc-biblioref">Schaefer et al., 2013</a>)</span>.</p>
</section>
<section id="gaps-in-the-literature" class="level2">
<h2 data-anchor-id="gaps-in-the-literature">Gaps in the Literature</h2>
<p>Despite extensive research on happiness and purpose in life, several gaps persist in the literature. Notably, too many studies are limited to the measurement of only one of these two constructs. If both happiness and purpose are measured, there is a scarcity of studies examining the relationship between these constructs over time and their sensitivity to change. Most existing research relies on cross-sectional designs, limiting the ability to conclude causality and the cross-lagged links between happiness and purpose. Additionally, while there is evidence for the adequate psychometric properties of the Subjective Happiness Scale and Brief Measure of Purpose in Life, their stability and responsiveness to change have not been thoroughly investigated. Addressing these gaps is crucial for building models of people across time and situations.</p>
</section>
<section id="the-present-research" class="level2">
<h2 data-anchor-id="the-present-research">The Present Research</h2>
<p>Building on prior work differentiating happiness and purpose <span class="citation" data-cites="ryff1989happiness">(e.g., <a href="#ref-ryff1989happiness" role="doc-biblioref">Ryff, 1989</a>)</span>, we examined differences in temporal stability. Initially, we examined the psychometric properties for purpose and happiness to determine whether they are equivalent (i.e., in reliability, validity, and stability). If purpose and happiness differ in their psychometric properties, this would offer an alternative explanation for any study of causes, correlates, and consequences. With the inclusion of 6-month and 2-year follow-up surveys, our work allowed for tests of the shorter and longer-term patterns uniquely linked to happy and purposeful living. Using longitudinal data (i.e., cross-lagged analyses across assessment periods), we examined whether purpose causes or influences happiness, whether happiness causes or influences purpose, or if it is bi-directional.</p>
<p>Our goal was to explore the effectiveness of measuring happiness and purpose and their relation to each other over time. While we are interested in these two constructs, we offer this research program as a model for any constructs regularly discussed in tandem (such as the Big Five personality traits, the separability of depression and social anxiety, or guilt and shame). Before determining whether there are key differences between at least two psychological states or traits <span class="citation" data-cites="baumeister2013some sheldon2015experiential">(e.g., <a href="#ref-baumeister2013some" role="doc-biblioref">Baumeister et al., 2013</a>; <a href="#ref-sheldon2015experiential" role="doc-biblioref">Sheldon et al., 2015</a>)</span>, it is essential to evaluate whether there are meaningful psychometric differences - because if one of the two is more reliable and stable, then any inference of causality from these correlational models becomes tenuous at best.</p>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="participants-and-procedure" class="level2">
<h2 data-anchor-id="participants-and-procedure">Participants and Procedure</h2>
<p>We recruited a community sample of adults from the US mid-Atlantic region through local advertisements. The baseline sample (Time one; T1 <em>n</em> = 303) completed trait measures and ideographic assessments in the laboratory and subsequently completed follow-up measures six months later (Time two; T2 <em>n</em> = 205) and two years later (Time three; T3 <em>n</em> = 167) through an online survey platform. Sample sizes noted depend largely on the completeness of the data by individual and by time. Full demographics of the sample are available in <a href="#tbl-t1demos" class="quarto-xref" aria-expanded="false">Table&nbsp;1</a>. Simply put, our sample is best characterized as mostly well-educated (<span class="math inline">45\%</span>), white (<span class="math inline">42\%</span>) or Asian (<span class="math inline">18\%</span>) women (<span class="math inline">59.4\%</span>) in their early twenties to mid-thirties (<span class="math inline">M = 31.44; SD = 13.5</span>) who were largely employed full-time (<span class="math inline">30\%</span>), part-time (<span class="math inline">20\%</span>) or students (<span class="math inline">19\%</span>), with a median household income between US$20,000 and US$30,000. Note the median income is strongly weighted downward by the almost <span class="math inline">40\%</span> of the sample being unemployed, underemployed, and/or in debt. Regardless, the sample is representative of the region from which it was drawn.</p>
<section id="purpose" class="level3">
<h3 data-anchor-id="purpose">Purpose</h3>
<p>Brief Measure of Purpose in Life (BPIL) <span class="citation" data-cites="hill2016assessing">(<a href="#ref-hill2016assessing" role="doc-biblioref">Hill et al., 2016</a>)</span>. The 4-item BPIL measures the degree to which one has a clear mission in life (e.g., <em>“My plans for the future match with my true interests and values’’</em>). Items are rated on a 5-point Likert scale (from 1 or <em>not at all</em> to 5 or <em>very much</em>). All scores were converted from the traditional 1-5 item scores and 4-20 total scores to POMP or percent of maximum possible scores (Cohen, Cohen, Aiken, &amp; West, 2010); thus, the final scores range from 0 to 100. The BPIL demonstrates good construct validity through its positive associations with prior measures of purpose, hope, and positive affect. Prior research shows that the BPIL demonstrated adequate reliability <span class="citation" data-cites="hill2016assessing">(<a href="#ref-hill2016assessing" role="doc-biblioref">Hill et al., 2016</a>)</span>.</p>
</section>
<section id="happiness" class="level3">
<h3 data-anchor-id="happiness">Happiness</h3>
<p>The 4-item Subjective Happiness Scale (SHS) <span class="citation" data-cites="lyubomirsky1999measure">(<a href="#ref-lyubomirsky1999measure" role="doc-biblioref">Lyubomirsky &amp; Lepper, 1999</a>)</span> assesses global subjective happiness using a 7-point Likert scale with different anchors (1 or <em>not a very happy person</em> to 7 or <em>a very happy person</em>; 1 or <em>less happy</em> to 7 or <em>more happy</em>; 1 or <em>not at all</em> to 7 or <em>a great deal</em>) based on individual items (e.g., <em>Some people are generally very happy. They enjoy life regardless of what is going on and get the most out of everything. To what extent does this characterization describe you?</em>). All scores were converted from the traditional 1-7 item scores and 4-28 total scores to POMP or percent of maximum possible scores <span class="citation" data-cites="cohen2010best">(<a href="#ref-cohen2010best" role="doc-biblioref">Cohen et al., 2010</a>)</span>; thus, the final scores range from 0 to 100. The SHS exhibits satisfactory convergent validity through its strong relationships with other happiness-related scales. Prior research shows that the SHS demonstrated adequate reliability <span class="citation" data-cites="lyubomirsky1999measure">(<a href="#ref-lyubomirsky1999measure" role="doc-biblioref">Lyubomirsky &amp; Lepper, 1999</a>)</span>.</p>
</section>
</section>
<section id="data-analytic-approach" class="level2">
<h2 data-anchor-id="data-analytic-approach">Data Analytic Approach</h2>
<p>Ultimately, we aimed to test the causal direction between purpose and happiness through a cross-lagged panel model. To ensure some level of interpretability for that model, we tested two critical assumptions: Assumption 1 - comparable psychometrics and Assumption 2 - factorial invariance. First, we provide basic descriptive statistics and classical test theory analyses to help us determine the extent to which the two measures were psychometrically comparable (Assumption 1). If both happiness and purpose were measured with relatively equivalent psychometric properties (here, reliability estimates), then we could compare correlations within and between administrations more readily and, largely without caveat. Second, we needed to ensure that the measurement models for both happiness and purpose were invariant over time - a term referred to as factorial invariance (Assumption 2). We used a multi-sample confirmatory factor analysis (CFA) to test for factorial invariance. The results helped us understand the nature of the scores produced by the factor models. Specifically, we hoped for scalar invariance because such a level ensures that scores captured over time were comparable. Thus, we could procede without hesitation to test the causal nature of purpose and happiness via the cross-lagged panel model <span class="citation" data-cites="duckworth2010establishing">(cf <a href="#ref-duckworth2010establishing" role="doc-biblioref">Duckworth et al., 2010</a>)</span>. All data preparation, analysis, and reporting were performed using R Statistical Software <span class="citation" data-cites="base">(<a href="#ref-base" role="doc-biblioref">2025</a>)</span>. We detail those results below.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>The results of our analyses are broken down into three distinct sections. First, we address the basic properties of the happiness and purpose measures, including their psychometric properties and stability over time. Second, we present the results of a multisample confirmatory factor analysis (CFA) to determine whether the two constructs - happiness and purpose - were both stable measurement models. Furthermore, the CFA analysis results help us determine if the values produced over time and between measure were comparable. Third, we present the results of the cross-lagged panel analysis that helped us determine the causal direction between happiness and purpose.</p>
<section id="assumption-1-comparable-psychometric-properties" class="level2">
<h2 data-anchor-id="assumption-1-comparable-psychometric-properties">Assumption 1: Comparable Psychometric Properties</h2>
<p>The two measures demonstrated equivalent reliability estimates within and between administrations (see <a href="#tbl-assumption1" class="quarto-xref" aria-expanded="false">Table&nbsp;2</a>). Individually, the measures demonstrated high internal consistency and no serious problems with respect to ill-fitting items. The weighted mean alpha for each measure were both remarkably similar and stable for both (<span class="math inline">\bar{\alpha}_{happiness} = 0.881</span> for happiness and <span class="math inline">\bar{\alpha}_{purpose} = 0.872</span> for purpose. With little change in reliability within or between measure, we concluded that differential reliability between measures could be safely ruled out in the following models. Thus, we passed an essential test to be able to interpret causality of the assumption regarding cross-panel models is that the measures being compared are relatively equivalent in their reliability <span class="citation" data-cites="rogosa1980critique">(<a href="#ref-rogosa1980critique" role="doc-biblioref">Rogosa, 1980</a>)</span>. Additionally, we need to establish that the measurement models are relatively invariant over time - another assumption that we directly address in the next model.</p>
</section>
<section id="assumption-2-do-the-factors-show-evidence-of-factorial-invariance" class="level2">
<h2 data-anchor-id="assumption-2-do-the-factors-show-evidence-of-factorial-invariance">Assumption 2: Do The Factors Show Evidence of Factorial Invariance?</h2>
<p>To assess the stability of the measurement models for both purpose and happiness, we used contemporary measurement invariance tests <span class="citation" data-cites="vandenbergReviewSynthesisMeasurement2000">(<a href="#ref-vandenbergReviewSynthesisMeasurement2000" role="doc-biblioref">Vandenberg &amp; Lance, 2000</a>)</span>. We conducted a multisample confirmatory factor analysis (CFA) to determine whether the measurement models for happiness and purpose were stable across timepoints (i.e., baseline, follow-up 1 (6 months), and follow-up 2 (2 years)). The tests required increasingly stringent constraints to test for configural, metric, and scalar invariance. Configural invariance tests whether the same items load onto the same factors across timepoints. Metric invariance tests whether the factor loadings are equivalent across timepoints. Finally, scalar invariance tests whether the factor loadings and intercepts are equivalent across timepoints. Our hope is always to find evidence for scalar invariance since that level of invariance allows us to have direct comparisons within and between constructs. We found that scalar invariance - the most constrained and useful model result - fit best <a href="#tbl-invtest" class="quarto-xref" aria-expanded="false">Table&nbsp;3</a>. Specifically, we chose the model that fit well (<span class="math inline">CFI &gt; 0.95</span> &amp; <span class="math inline">RMSEA &lt; 0.05</span>), and lowest BIC of the three models. The Scalar invariance model met all of those criteria and, as a result, offered us the most defensible measurement model. The implications of these results are that the following causal model can be usefully applied to this data. The details of these results can be best seen in <a href="#fig-invtest" class="quarto-xref" aria-expanded="false">Figure&nbsp;1</a>.</p>
</section>
</section>
<section id="final-analysis-what-is-temporal-relationship-between-happiness-and-purpose" class="level1">
<h1>Final Analysis: What is Temporal Relationship between Happiness and Purpose?</h1>
</section>
<section id="analysis-3-cross-lagged-panel-analysis-causal-direction" class="level1">
<h1>Analysis 3: Cross-lagged Panel Analysis (Causal Direction)</h1>
</section>
<section id="save-for-later" class="level1">
<h1>SAVE FOR LATER</h1>
</section>
<section id="analysis-4-quantile-regression-deeper-look-into-the-relationship" class="level1">
<h1>Analysis 4: Quantile Regression (Deeper Look into the Relationship)</h1>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="1" data-custom-style="FigureWithoutNote">
<div id="tbl-t1demos" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="1">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-t1demos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;1</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Table 1. Demographic Characteristics (N = 345)</p>
</div>
</figcaption>
<div aria-describedby="tbl-t1demos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="lightable-classic table table-striped table-hover do-not-create-environment cell caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Variable</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Category</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">M = 31.44 (SD = 13.50), Range: 18-81</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gender</td>
<td style="text-align: left;">Man</td>
<td style="text-align: right;">102 (29.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Woman</td>
<td style="text-align: right;">205 (59.4%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Other (please specify)</td>
<td style="text-align: right;">3 (0.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Race/Ethnicity</td>
<td style="text-align: left;">White / Caucasian</td>
<td style="text-align: right;">146 (42.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Black / African-American</td>
<td style="text-align: right;">44 (12.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Latino / Hispanic</td>
<td style="text-align: right;">26 (7.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Asian / Pacific Islander</td>
<td style="text-align: right;">62 (18.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Arab / Middle-eastern</td>
<td style="text-align: right;">11 (3.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Other (please specify)</td>
<td style="text-align: right;">21 (6.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">Some high school</td>
<td style="text-align: right;">1 (0.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">High school graduate</td>
<td style="text-align: right;">46 (13.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Trade/Technical/Vocational school graduate</td>
<td style="text-align: right;">3 (0.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Some College/University</td>
<td style="text-align: right;">62 (18.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">2-year College/University graduate (i.e., associate's degree)</td>
<td style="text-align: right;">22 (6.4%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">4-year College/University graduate (i.e., bachelor's degree)</td>
<td style="text-align: right;">85 (24.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Some graduate/professional school (e.g., Master’s school; Medical school)</td>
<td style="text-align: right;">21 (6.1%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Graduate school/professional degree (e.g., Master’s degree; Medical degree)</td>
<td style="text-align: right;">70 (20.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Employment Status</td>
<td style="text-align: left;">Not employed</td>
<td style="text-align: right;">26 (7.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Part-time (29- hours a week)</td>
<td style="text-align: right;">69 (20.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Full time (30+ hours a week)</td>
<td style="text-align: right;">101 (29.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Homemaker/volunteer</td>
<td style="text-align: right;">8 (2.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Student (full-time)</td>
<td style="text-align: right;">66 (19.1%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retired</td>
<td style="text-align: right;">13 (3.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Other (please specify)</td>
<td style="text-align: right;">27 (7.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Occupation</td>
<td style="text-align: left;">Management, professional, related</td>
<td style="text-align: right;">100 (29.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Service</td>
<td style="text-align: right;">84 (24.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Sales and office</td>
<td style="text-align: right;">31 (9.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Farming, fishing, and forestry</td>
<td style="text-align: right;">3 (0.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Construction, extraction, and maintenance</td>
<td style="text-align: right;">4 (1.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Production, transportation, and material moving</td>
<td style="text-align: right;">3 (0.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Government</td>
<td style="text-align: right;">20 (5.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">I do not have a job</td>
<td style="text-align: right;">60 (17.4%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annual Household Income</td>
<td style="text-align: left;">Less than $10,000</td>
<td style="text-align: right;">100 (29.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">$10,001 - $20,000</td>
<td style="text-align: right;">39 (11.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">$20,001 - $30,000</td>
<td style="text-align: right;">22 (6.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">$30,001 - $40,000</td>
<td style="text-align: right;">18 (5.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">$40,001 - $50,000</td>
<td style="text-align: right;">19 (5.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">$50,001 - $60,000</td>
<td style="text-align: right;">21 (6.1%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">$60,001 - $70,000</td>
<td style="text-align: right;">9 (2.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">$70,001 - $80,000</td>
<td style="text-align: right;">16 (4.6%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">$80,001 - $90,000</td>
<td style="text-align: right;">14 (4.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">$90,001 - $100,000</td>
<td style="text-align: right;">3 (0.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">$100,001 - $150,000</td>
<td style="text-align: right;">28 (8.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">$150,001 - $200,000</td>
<td style="text-align: right;">11 (3.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">More than $200,000</td>
<td style="text-align: right;">10 (2.9%)</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="2" data-custom-style="FigureWithoutNote">
<div id="tbl-assumption1" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="2">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-assumption1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;2</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Psychometric Properties of Happiness and Purpose Measures Across Timepoints (POMP Scores)</p>
</div>
</figcaption>
<div aria-describedby="tbl-assumption1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Timepoint</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">N</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">SD</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Cronbach's α</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="3">
<td colspan="7" style="border-bottom: 1px solid"><strong>Happiness</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Baseline</td>
<td style="text-align: right;">328</td>
<td style="text-align: right;">61.94</td>
<td style="text-align: right;">22.44</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">100.00</td>
<td style="text-align: right;">0.874</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Follow-up 1</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">62.69</td>
<td style="text-align: right;">23.42</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">100.00</td>
<td style="text-align: right;">0.887</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Follow-up 2</td>
<td style="text-align: right;">119</td>
<td style="text-align: right;">60.15</td>
<td style="text-align: right;">23.54</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">95.83</td>
<td style="text-align: right;">0.889</td>
</tr>
<tr class="odd" data-grouplength="3">
<td colspan="7" style="border-bottom: 1px solid"><strong>Purpose</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Baseline</td>
<td style="text-align: right;">314</td>
<td style="text-align: right;">67.71</td>
<td style="text-align: right;">22.32</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">100.00</td>
<td style="text-align: right;">0.844</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Follow-up 1</td>
<td style="text-align: right;">197</td>
<td style="text-align: right;">69.04</td>
<td style="text-align: right;">21.20</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">100.00</td>
<td style="text-align: right;">0.904</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Follow-up 2</td>
<td style="text-align: right;">119</td>
<td style="text-align: right;">68.22</td>
<td style="text-align: right;">22.66</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">100.00</td>
<td style="text-align: right;">0.884</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="3" data-custom-style="FigureWithoutNote">
<div id="tbl-invtest" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="3">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-invtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;3</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Model Fit Comparison Across Invariance Levels</p>
</div>
</figcaption>
<div aria-describedby="tbl-invtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Model Fit Comparison Across Invariance Levels</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ChiSq</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CFI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSEA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SRMR</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Configural</td>
<td style="text-align: right;">68.55</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">0.995</td>
<td style="text-align: right;">0.031</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">14482</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metric</td>
<td style="text-align: right;">84.76</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">0.993</td>
<td style="text-align: right;">0.033</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">14423</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scalar</td>
<td style="text-align: right;">106.61</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">0.989</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: right;">0.047</td>
<td style="text-align: right;">14368</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="4" data-custom-style="FigureWithoutNote">
<div id="tbl-cfamoddeltas" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="4">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-cfamoddeltas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;4</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Model Differences Across Invariance Levels</p>
</div>
</figcaption>
<div aria-describedby="tbl-cfamoddeltas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Model Differences Across Invariance Levels</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Comparison</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dCFI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dRMSEA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dBIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Metric vs. Configural</td>
<td style="text-align: right;">-0.0018764</td>
<td style="text-align: right;">0.0018994</td>
<td style="text-align: right;">-59.56261</td>
</tr>
<tr class="even">
<td style="text-align: left;">Scalar vs. Metric</td>
<td style="text-align: right;">-0.0043836</td>
<td style="text-align: right;">0.0057456</td>
<td style="text-align: right;">-54.95428</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="5" data-custom-style="FigureWithoutNote">
<div id="tbl-loadings" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="5">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-loadings-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;5</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Standardized Factor Loadings (estimate (SE))</p>
</div>
</figcaption>
<div aria-describedby="tbl-loadings-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Standardized Factor Loadings (estimate (SE))</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">group</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">param_label</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">est_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Happiness =~ shs_gh_a</td>
<td style="text-align: left;">0.906 (0.013)</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Happiness =~ shs_rh_a</td>
<td style="text-align: left;">0.888 (0.017)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Happiness =~ shs_ch_a</td>
<td style="text-align: left;">0.799 (0.026)</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Happiness =~ shs_ch_r</td>
<td style="text-align: left;">0.613 (0.036)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Purpose =~ bpurp_1</td>
<td style="text-align: left;">0.816 (0.027)</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Purpose =~ bpurp_2</td>
<td style="text-align: left;">0.712 (0.034)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Purpose =~ bpurp_3</td>
<td style="text-align: left;">0.856 (0.024)</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Purpose =~ bpurp_4</td>
<td style="text-align: left;">0.706 (0.032)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Happiness =~ shs_gh_a</td>
<td style="text-align: left;">0.887 (0.022)</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Happiness =~ shs_rh_a</td>
<td style="text-align: left;">0.876 (0.022)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Happiness =~ shs_ch_a</td>
<td style="text-align: left;">0.862 (0.022)</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Happiness =~ shs_ch_r</td>
<td style="text-align: left;">0.669 (0.042)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Purpose =~ bpurp_1</td>
<td style="text-align: left;">0.838 (0.034)</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Purpose =~ bpurp_2</td>
<td style="text-align: left;">0.825 (0.031)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Purpose =~ bpurp_3</td>
<td style="text-align: left;">0.877 (0.025)</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Purpose =~ bpurp_4</td>
<td style="text-align: left;">0.805 (0.032)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Happiness =~ shs_gh_a</td>
<td style="text-align: left;">0.928 (0.018)</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Happiness =~ shs_rh_a</td>
<td style="text-align: left;">0.918 (0.026)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Happiness =~ shs_ch_a</td>
<td style="text-align: left;">0.834 (0.030)</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Happiness =~ shs_ch_r</td>
<td style="text-align: left;">0.664 (0.047)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Purpose =~ bpurp_1</td>
<td style="text-align: left;">0.856 (0.030)</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Purpose =~ bpurp_2</td>
<td style="text-align: left;">0.738 (0.055)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Purpose =~ bpurp_3</td>
<td style="text-align: left;">0.883 (0.032)</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Purpose =~ bpurp_4</td>
<td style="text-align: left;">0.758 (0.045)</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="6" data-custom-style="FigureWithoutNote">
<div id="tbl-correlations" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="6">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-correlations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;6</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Factor Correlation (estimate (SE))</p>
</div>
</figcaption>
<div aria-describedby="tbl-correlations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Factor Correlation (estimate (SE))</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">param_label</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">est_se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Happiness ~~ Purpose</td>
<td style="text-align: left;">0.438 (0.055)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Happiness ~~ Purpose</td>
<td style="text-align: left;">0.529 (0.063)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Happiness ~~ Purpose</td>
<td style="text-align: left;">0.449 (0.089)</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="7" data-custom-style="FigureWithoutNote">
<div id="tbl-STDcorrs" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="7">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-STDcorrs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;7</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Standardized Correlations Between Purpose and Happiness (POMP Scores)</p>
</div>
</figcaption>
<div aria-describedby="tbl-STDcorrs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">LHS</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">RHS</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Correlation (r)</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">baseline_happiness</td>
<td style="text-align: left;">baseline_purpose</td>
<td style="text-align: center;">0.4291807</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">followup1_happiness</td>
<td style="text-align: left;">followup1_purpose</td>
<td style="text-align: center;">0.5279526</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">followup2_happiness</td>
<td style="text-align: left;">followup2_purpose</td>
<td style="text-align: center;">0.4781300</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">baseline_happiness</td>
<td style="text-align: left;">followup1_happiness</td>
<td style="text-align: center;">0.8019610</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">baseline_happiness</td>
<td style="text-align: left;">followup1_purpose</td>
<td style="text-align: center;">0.4400944</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">baseline_happiness</td>
<td style="text-align: left;">followup2_happiness</td>
<td style="text-align: center;">0.7991375</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">baseline_happiness</td>
<td style="text-align: left;">followup2_purpose</td>
<td style="text-align: center;">0.5680772</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">baseline_purpose</td>
<td style="text-align: left;">followup1_happiness</td>
<td style="text-align: center;">0.2804335</td>
<td style="text-align: center;">0.0000475</td>
</tr>
<tr class="odd">
<td style="text-align: left;">baseline_purpose</td>
<td style="text-align: left;">followup1_purpose</td>
<td style="text-align: center;">0.6888230</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">baseline_purpose</td>
<td style="text-align: left;">followup2_happiness</td>
<td style="text-align: center;">0.3068394</td>
<td style="text-align: center;">0.0001238</td>
</tr>
<tr class="odd">
<td style="text-align: left;">baseline_purpose</td>
<td style="text-align: left;">followup2_purpose</td>
<td style="text-align: center;">0.5834387</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">followup1_happiness</td>
<td style="text-align: left;">followup2_happiness</td>
<td style="text-align: center;">0.8023372</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">followup1_happiness</td>
<td style="text-align: left;">followup2_purpose</td>
<td style="text-align: center;">0.4947283</td>
<td style="text-align: center;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">followup1_purpose</td>
<td style="text-align: left;">followup2_happiness</td>
<td style="text-align: center;">0.3803629</td>
<td style="text-align: center;">0.0000004</td>
</tr>
<tr class="odd">
<td style="text-align: left;">followup1_purpose</td>
<td style="text-align: left;">followup2_purpose</td>
<td style="text-align: center;">0.7230741</td>
<td style="text-align: center;">0.0000000</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Standardized Correlations Between Purpose and Happiness (POMP Scores)</caption>
<colgroup>
<col style="width: 3%">
<col style="width: 65%">
<col style="width: 20%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Relationship</th>
<th style="text-align: right;">Correlation (r)</th>
<th style="text-align: left;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">12</td>
<td style="text-align: left;">happiness at followup1 with happiness at followup2</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">happiness at baseline with happiness at followup1</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">happiness at baseline with happiness at followup2</td>
<td style="text-align: right;">0.799</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">15</td>
<td style="text-align: left;">purpose at followup1 with purpose at followup2</td>
<td style="text-align: right;">0.723</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: left;">purpose at baseline with purpose at followup1</td>
<td style="text-align: right;">0.689</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">11</td>
<td style="text-align: left;">purpose at baseline with purpose at followup2</td>
<td style="text-align: right;">0.583</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">happiness at baseline with purpose at followup2</td>
<td style="text-align: right;">0.568</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">happiness at followup1 with purpose at followup1</td>
<td style="text-align: right;">0.528</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">13</td>
<td style="text-align: left;">happiness at followup1 with purpose at followup2</td>
<td style="text-align: right;">0.495</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">happiness at followup2 with purpose at followup2</td>
<td style="text-align: right;">0.478</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">happiness at baseline with purpose at followup1</td>
<td style="text-align: right;">0.440</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">happiness at baseline with purpose at baseline</td>
<td style="text-align: right;">0.429</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">14</td>
<td style="text-align: left;">purpose at followup1 with happiness at followup2</td>
<td style="text-align: right;">0.380</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: left;">purpose at baseline with happiness at followup2</td>
<td style="text-align: right;">0.307</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">purpose at baseline with happiness at followup1</td>
<td style="text-align: right;">0.280</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Cross-sectional Correlations (Same Time Point)</caption>
<colgroup>
<col style="width: 67%">
<col style="width: 21%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Relationship</th>
<th style="text-align: right;">Correlation (r)</th>
<th style="text-align: left;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">happiness at followup1 with purpose at followup1</td>
<td style="text-align: right;">0.528</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">happiness at followup2 with purpose at followup2</td>
<td style="text-align: right;">0.478</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">happiness at baseline with purpose at baseline</td>
<td style="text-align: right;">0.429</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Longitudinal Correlations (Different Time Points)</caption>
<colgroup>
<col style="width: 68%">
<col style="width: 21%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Relationship</th>
<th style="text-align: right;">Correlation (r)</th>
<th style="text-align: left;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">happiness at followup1 with happiness at followup2</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">happiness at baseline with happiness at followup1</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">happiness at baseline with happiness at followup2</td>
<td style="text-align: right;">0.799</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">purpose at followup1 with purpose at followup2</td>
<td style="text-align: right;">0.723</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">purpose at baseline with purpose at followup1</td>
<td style="text-align: right;">0.689</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">purpose at baseline with purpose at followup2</td>
<td style="text-align: right;">0.583</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">happiness at baseline with purpose at followup2</td>
<td style="text-align: right;">0.568</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">happiness at followup1 with purpose at followup2</td>
<td style="text-align: right;">0.495</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">happiness at baseline with purpose at followup1</td>
<td style="text-align: right;">0.440</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">purpose at followup1 with happiness at followup2</td>
<td style="text-align: right;">0.380</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">purpose at baseline with happiness at followup2</td>
<td style="text-align: right;">0.307</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">purpose at baseline with happiness at followup1</td>
<td style="text-align: right;">0.280</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell FigureWithoutNote" prefix="" data-tblnum="8" data-custom-style="FigureWithoutNote">
<div id="tbl-crosslagged" class="cell quarto-float quarto-figure quarto-figure-center" prefix="" data-tblnum="8">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-crosslagged-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;8</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Cross-Lagged Panel Model Path Coefficients</p>
</div>
</figcaption>
<div aria-describedby="tbl-crosslagged-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Path Type</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Path</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Coefficient</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Standardized</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">p-value</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;"></th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Auto-regressive Paths</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Auto-regressive</td>
<td style="text-align: left;">Happiness (T1→T2)</td>
<td style="text-align: right;">0.783</td>
<td style="text-align: right;">0.740</td>
<td style="text-align: right;">&lt; .001</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Auto-regressive</td>
<td style="text-align: left;">Happiness (T2→T3)</td>
<td style="text-align: right;">0.718</td>
<td style="text-align: right;">0.742</td>
<td style="text-align: right;">&lt; .001</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Auto-regressive</td>
<td style="text-align: left;">Purpose (T1→T2)</td>
<td style="text-align: right;">0.544</td>
<td style="text-align: right;">0.556</td>
<td style="text-align: right;">&lt; .001</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Auto-regressive</td>
<td style="text-align: left;">Purpose (T2→T3)</td>
<td style="text-align: right;">0.609</td>
<td style="text-align: right;">0.582</td>
<td style="text-align: right;">&lt; .001</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="even" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Cross-lagged Paths</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Cross-lagged</td>
<td style="text-align: left;">Happiness→Purpose (T1→T2)</td>
<td style="text-align: right;">0.168</td>
<td style="text-align: right;">0.185</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: center;">**</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Cross-lagged</td>
<td style="text-align: left;">Happiness→Purpose (T2→T3)</td>
<td style="text-align: right;">0.149</td>
<td style="text-align: right;">0.165</td>
<td style="text-align: right;">0.028</td>
<td style="text-align: center;">*</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Cross-lagged</td>
<td style="text-align: left;">Purpose→Happiness (T1→T2)</td>
<td style="text-align: right;">-0.039</td>
<td style="text-align: right;">-0.035</td>
<td style="text-align: right;">0.527</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Cross-lagged</td>
<td style="text-align: left;">Purpose→Happiness (T2→T3)</td>
<td style="text-align: right;">-0.049</td>
<td style="text-align: right;">-0.043</td>
<td style="text-align: right;">0.558</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd" data-grouplength="2">
<td colspan="6" style="border-bottom: 1px solid"><strong>Indirect Effects</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Indirect Effect</td>
<td style="text-align: left;">Purpose→Happiness→Purpose</td>
<td style="text-align: right;">0.064</td>
<td style="text-align: right;">—</td>
<td style="text-align: right;">0.199</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Indirect Effect</td>
<td style="text-align: left;">Happiness→Purpose→Happiness</td>
<td style="text-align: right;">-0.043</td>
<td style="text-align: right;">—</td>
<td style="text-align: right;">0.558</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div id="tbl-quantile-regression" class="cell quarto-float quarto-figure quarto-figure-center FigureWithoutNote" prefix="" data-tblnum="9" data-custom-style="FigureWithoutNote">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-quantile-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;9</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Quantile Regression Slopes: Happiness Regressed on Purpose</p>
</div>
</figcaption>
<div aria-describedby="tbl-quantile-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>

</div>
</div>
</figure>
</div>
<div class="cell FigureWithoutNote" data-custom-style="FigureWithoutNote">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for analysis with debug info</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>prepare_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print input data structure</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#message("Input data structure:")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(data)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First, create a proper person-level ID</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  data_with_pid <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pid =</span> <span class="fu">row_number</span>())</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create long format for all measurements</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  data_long <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    long_data <span class="ot">&lt;-</span> data_with_pid <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(id, pid),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"name"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Separate the components after pivoting</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">timepoint =</span> <span class="fu">str_extract</span>(name, <span class="st">"^(b|fu1|fu2)"</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">measure =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"shs"</span>) <span class="sc">~</span> <span class="st">"shs"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"bpurp"</span>) <span class="sc">~</span> <span class="st">"bpurp"</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">item =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"gh_a$"</span>) <span class="sc">~</span> <span class="st">"gh_a"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"rh_a$"</span>) <span class="sc">~</span> <span class="st">"rh_a"</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"ch_a$"</span>) <span class="sc">~</span> <span class="st">"ch_a"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"_r$"</span>) <span class="sc">~</span> <span class="st">"ch_r"</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(name, <span class="st">"bpurp_([0-9])$"</span>) <span class="sc">~</span> <span class="fu">str_extract</span>(name, <span class="st">"[0-9]$"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>name)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print diagnostics</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># message("\nUnique timepoints after pivot:")</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(unique(long_data$timepoint))</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># message("\nUnique measures after pivot:")</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(unique(long_data$measure))</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># message("\nUnique items after pivot:")</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(unique(long_data$item))</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    long_data <span class="ot">&lt;-</span> long_data <span class="sc">%&gt;%</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">timepoint =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>          timepoint <span class="sc">==</span> <span class="st">"b"</span> <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>          timepoint <span class="sc">==</span> <span class="st">"fu1"</span> <span class="sc">~</span> <span class="st">"2"</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>          timepoint <span class="sc">==</span> <span class="st">"fu2"</span> <span class="sc">~</span> <span class="st">"3"</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">item_clean =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>          measure <span class="sc">==</span> <span class="st">"shs"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(item, <span class="st">"gh_a"</span>) <span class="sc">~</span> <span class="st">"shs_gh_a"</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>          measure <span class="sc">==</span> <span class="st">"shs"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(item, <span class="st">"rh_a"</span>) <span class="sc">~</span> <span class="st">"shs_rh_a"</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>          measure <span class="sc">==</span> <span class="st">"shs"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(item, <span class="st">"ch_a"</span>) <span class="sc">~</span> <span class="st">"shs_ch_a"</span>,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>          measure <span class="sc">==</span> <span class="st">"shs"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(item, <span class="st">"_r"</span>) <span class="sc">~</span> <span class="st">"shs_ch_r"</span>,  <span class="co"># Modified to catch b_r and fu1_r</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>          measure <span class="sc">==</span> <span class="st">"bpurp"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(item, <span class="st">"^[0-9]$"</span>) <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"bpurp_"</span>, item)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print item_clean values to verify transformation</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#message("\nUnique cleaned items:")</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(unique(long_data$item_clean))</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    final_data <span class="ot">&lt;-</span> long_data <span class="sc">%&gt;%</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(pid, timepoint, item_clean, value) <span class="sc">%&gt;%</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">id_cols =</span> <span class="fu">c</span>(pid, timepoint),</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from =</span> item_clean,</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> value</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>pid) <span class="sc">%&gt;%</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">timepoint =</span> <span class="fu">factor</span>(timepoint))</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print final data structure</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">#message("\nFinal data structure:")</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">#str(final_data)</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(final_data)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error in data preparation: "</span>, e<span class="sc">$</span>message)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data_long)</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to fit model with proper scaling</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>fit_cfa_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">constraints =</span> <span class="st">"configural"</span>) {</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the measurement model</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="st">'</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="st">    # Measurement models for each construct</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="st">    Happiness =~ NA*shs_gh_a + shs_rh_a + shs_ch_a + shs_ch_r</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="st">    Purpose =~ NA*bpurp_1 + bpurp_2 + bpurp_3 + bpurp_4</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="st">    # Set scale by fixing first loading to 1</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="st">    Happiness =~ 1*shs_gh_a</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="st">    Purpose =~ 1*bpurp_1</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="st">  '</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add constraints based on level of invariance</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> model,</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"timepoint"</span>,</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing =</span> <span class="st">"fiml"</span>,</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimator =</span> <span class="st">"MLR"</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(constraints <span class="sc">==</span> <span class="st">"metric"</span>) {</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>group.equal <span class="ot">&lt;-</span> <span class="st">"loadings"</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(constraints <span class="sc">==</span> <span class="st">"scalar"</span>) {</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    args<span class="sc">$</span>group.equal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"loadings"</span>, <span class="st">"intercepts"</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model with tryCatch</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(lavaan<span class="sc">::</span>cfa, args)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error fitting model: "</span>, e<span class="sc">$</span>message)</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fit)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract fit measures</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>extract_fit_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(fit) {</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(fit)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  measures <span class="ot">&lt;-</span> <span class="fu">fitmeasures</span>(fit)</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  selected_fits <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chisq.scaled"</span>, <span class="st">"df.scaled"</span>, <span class="st">"pvalue.scaled"</span>,</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cfi.scaled"</span>, <span class="st">"tli.scaled"</span>, <span class="st">"rmsea.scaled"</span>,</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="st">"srmr"</span>, <span class="st">"bic"</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(measures[selected_fits])</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Main analysis function</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>run_measurement_invariance <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if input data exists</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(data)) {</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Input data is NULL"</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare data</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Preparing data..."</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  long_data <span class="ot">&lt;-</span> <span class="fu">prepare_data</span>(data)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(long_data)) {</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Data preparation failed"</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if required variables exist</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>  required_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"shs_gh_a"</span>, <span class="st">"shs_rh_a"</span>, <span class="st">"shs_ch_a"</span>, <span class="st">"shs_ch_r"</span>,</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"bpurp_1"</span>, <span class="st">"bpurp_2"</span>, <span class="st">"bpurp_3"</span>, <span class="st">"bpurp_4"</span>)</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>  missing_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_vars, <span class="fu">names</span>(long_data))</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(missing_vars) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing required variables: "</span>, <span class="fu">paste</span>(missing_vars, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results lists</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  model_fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  fit_indices <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit models</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Fitting models..."</span>)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>  model_fits<span class="sc">$</span>configural <span class="ot">&lt;-</span> <span class="fu">fit_cfa_model</span>(long_data, <span class="st">"configural"</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>  model_fits<span class="sc">$</span>metric <span class="ot">&lt;-</span> <span class="fu">fit_cfa_model</span>(long_data, <span class="st">"metric"</span>)</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  model_fits<span class="sc">$</span>scalar <span class="ot">&lt;-</span> <span class="fu">fit_cfa_model</span>(long_data, <span class="st">"scalar"</span>)</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if any models were successfully fit</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(<span class="fu">sapply</span>(model_fits, is.null))) {</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No models could be fit successfully"</span>)</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract fit measures</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  fit_indices<span class="sc">$</span>configural <span class="ot">&lt;-</span> <span class="fu">extract_fit_measures</span>(model_fits<span class="sc">$</span>configural)</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  fit_indices<span class="sc">$</span>metric <span class="ot">&lt;-</span> <span class="fu">extract_fit_measures</span>(model_fits<span class="sc">$</span>metric)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>  fit_indices<span class="sc">$</span>scalar <span class="ot">&lt;-</span> <span class="fu">extract_fit_measures</span>(model_fits<span class="sc">$</span>scalar)</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create comparison table</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>  comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Configural"</span>, <span class="st">"Metric"</span>, <span class="st">"Scalar"</span>)</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add fit measures if available</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(<span class="fu">sapply</span>(fit_indices, is.null))) {</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>    comparison<span class="sc">$</span>ChiSq <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_indices, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) <span class="fu">round</span>(x[<span class="st">"chisq.scaled"</span>], <span class="dv">2</span>) <span class="cf">else</span> <span class="cn">NA</span>)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>    comparison<span class="sc">$</span>df <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_indices, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) x[<span class="st">"df.scaled"</span>] <span class="cf">else</span> <span class="cn">NA</span>)</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>    comparison<span class="sc">$</span>CFI <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_indices, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) <span class="fu">round</span>(x[<span class="st">"cfi.scaled"</span>], <span class="dv">3</span>) <span class="cf">else</span> <span class="cn">NA</span>)</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>    comparison<span class="sc">$</span>RMSEA <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_indices, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) <span class="fu">round</span>(x[<span class="st">"rmsea.scaled"</span>], <span class="dv">3</span>) <span class="cf">else</span> <span class="cn">NA</span>)</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>    comparison<span class="sc">$</span>SRMR <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_indices, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) <span class="fu">round</span>(x[<span class="st">"srmr"</span>], <span class="dv">3</span>) <span class="cf">else</span> <span class="cn">NA</span>)</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>    comparison<span class="sc">$</span>BIC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_indices, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x)) <span class="fu">round</span>(x[<span class="st">"bic"</span>], <span class="dv">0</span>) <span class="cf">else</span> <span class="cn">NA</span>)</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate model differences</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  model_diffs <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">any</span>(<span class="fu">sapply</span>(fit_indices, is.null))) {</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    model_diffs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>      <span class="at">Comparison =</span> <span class="fu">c</span>(<span class="st">"Metric vs. Configural"</span>, <span class="st">"Scalar vs. Metric"</span>),</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>      <span class="at">dCFI =</span> <span class="fu">c</span>(</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>        fit_indices<span class="sc">$</span>metric[<span class="st">"cfi.scaled"</span>] <span class="sc">-</span> fit_indices<span class="sc">$</span>configural[<span class="st">"cfi.scaled"</span>],</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>        fit_indices<span class="sc">$</span>scalar[<span class="st">"cfi.scaled"</span>] <span class="sc">-</span> fit_indices<span class="sc">$</span>metric[<span class="st">"cfi.scaled"</span>]</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">dRMSEA =</span> <span class="fu">c</span>(</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>        fit_indices<span class="sc">$</span>metric[<span class="st">"rmsea.scaled"</span>] <span class="sc">-</span> fit_indices<span class="sc">$</span>configural[<span class="st">"rmsea.scaled"</span>],</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>        fit_indices<span class="sc">$</span>scalar[<span class="st">"rmsea.scaled"</span>] <span class="sc">-</span> fit_indices<span class="sc">$</span>metric[<span class="st">"rmsea.scaled"</span>]</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>      <span class="at">dBIC =</span> <span class="fu">c</span>(</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>        fit_indices<span class="sc">$</span>metric[<span class="st">"bic"</span>] <span class="sc">-</span> fit_indices<span class="sc">$</span>configural[<span class="st">"bic"</span>],</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>        fit_indices<span class="sc">$</span>scalar[<span class="st">"bic"</span>] <span class="sc">-</span> fit_indices<span class="sc">$</span>metric[<span class="st">"bic"</span>]</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract standardized parameters and create visualization</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>  loadings <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>  correlation <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>  measurement_diagram <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(model_fits<span class="sc">$</span>metric)) {</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    std_params <span class="ot">&lt;-</span> <span class="fu">standardizedSolution</span>(model_fits<span class="sc">$</span>metric)</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract factor loadings and correlation</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    loadings <span class="ot">&lt;-</span> std_params <span class="sc">%&gt;%</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(op <span class="sc">==</span> <span class="st">"=~"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>        <span class="at">est_se =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f (%.3f)"</span>, est.std, se),</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>        <span class="at">param_label =</span> <span class="fu">paste</span>(lhs, op, rhs)</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    correlation <span class="ot">&lt;-</span> std_params <span class="sc">%&gt;%</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(op <span class="sc">==</span> <span class="st">"~~"</span> <span class="sc">&amp;</span> lhs <span class="sc">!=</span> rhs) <span class="sc">%&gt;%</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">est_se =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f (%.3f)"</span>, est.std, se),</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>        <span class="at">param_label =</span> <span class="fu">paste</span>(lhs, op, rhs)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create combined diagram</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>  diagram <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(model_fits<span class="sc">$</span>metric)) {</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load qgraph</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qgraph"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>      <span class="fu">install.packages</span>(<span class="st">"qgraph"</span>)</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(qgraph)</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get parameter estimates for each timepoint</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    params_by_time <span class="ot">&lt;-</span> <span class="fu">standardizedSolution</span>(model_fits<span class="sc">$</span>metric)</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define variables and their order</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    manifest_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"shs_gh_a"</span>, <span class="st">"shs_rh_a"</span>, <span class="st">"shs_ch_a"</span>, <span class="st">"shs_ch_r"</span>,</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"bpurp_1"</span>, <span class="st">"bpurp_2"</span>, <span class="st">"bpurp_3"</span>, <span class="st">"bpurp_4"</span>)</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    latent_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Happiness"</span>, <span class="st">"Purpose"</span>)</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    var_names <span class="ot">&lt;-</span> <span class="fu">c</span>(latent_vars, manifest_vars)</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    n_vars <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create custom layout matrix for side-by-side latent variables with flanking indicators</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>    layout_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_vars, <span class="dv">2</span>)</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Position latent variables side by side in center</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    layout_matrix[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.28</span>, <span class="dv">0</span>)  <span class="co"># shs latent</span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    layout_matrix[<span class="dv">2</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.28</span>, <span class="dv">0</span>)   <span class="co"># bpurp latent</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Position SHS indicators on the left</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    layout_matrix[<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="fl">0.75</span>, <span class="dv">4</span>)  <span class="co"># x coordinates for shs indicators</span></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    layout_matrix[<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.28</span>, <span class="sc">-</span><span class="fl">0.28</span>, <span class="sc">-</span><span class="fl">0.75</span>)  <span class="co"># y coordinates spread vertically</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Position BPURP indicators on the right</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    layout_matrix[<span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.75</span>, <span class="dv">4</span>)  <span class="co"># x coordinates for bpurp indicators</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    layout_matrix[<span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.28</span>, <span class="sc">-</span><span class="fl">0.28</span>, <span class="sc">-</span><span class="fl">0.75</span>)  <span class="co"># y coordinates spread vertically</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create adjacency matrix</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    adj_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_vars, n_vars)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    edge_labels <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">""</span>, n_vars, n_vars)</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    edge_colors <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">""</span>, n_vars, n_vars)</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color scheme for timepoints - explicitly define each timepoint's color</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    time_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"darkred"</span>)</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill matrices with parameter estimates from all timepoints</span></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(t <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)) {</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>      time_params <span class="ot">&lt;-</span> params_by_time <span class="sc">%&gt;%</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> t)</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(time_params))) {</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(time_params<span class="sc">$</span>op[i] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"=~"</span>, <span class="st">"~~"</span>)) {</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>          from_idx <span class="ot">&lt;-</span> <span class="fu">match</span>(time_params<span class="sc">$</span>lhs[i], var_names)</span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>          to_idx <span class="ot">&lt;-</span> <span class="fu">match</span>(time_params<span class="sc">$</span>rhs[i], var_names)</span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(from_idx) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(to_idx)) {</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store the estimate in the adjacency matrix</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>            adj_matrix[from_idx, to_idx] <span class="ot">&lt;-</span> time_params<span class="sc">$</span>est.std[i]</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create multi-line label with estimates from all timepoints</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>            current_label <span class="ot">&lt;-</span> edge_labels[from_idx, to_idx]</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>            new_label <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%s: %.2f"</span>, t, time_params<span class="sc">$</span>est.std[i])</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>            edge_labels[from_idx, to_idx] <span class="ot">&lt;-</span> <span class="cf">if</span>(current_label <span class="sc">==</span> <span class="st">""</span>) new_label <span class="cf">else</span> <span class="fu">paste</span>(current_label, new_label, <span class="at">sep=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store color</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>            edge_colors[from_idx, to_idx] <span class="ot">&lt;-</span> time_colors[t]</span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For correlations, make bidirectional</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>            <span class="co">#if(time_params$op[i] == "~~" &amp;&amp; time_params$lhs[i] != time_params$rhs[i]) {</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>            <span class="co">#  adj_matrix[to_idx, from_idx] &lt;- time_params$est.std[i]</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>            <span class="co">#  edge_labels[to_idx, from_idx] &lt;- edge_labels[from_idx, to_idx]</span></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>            <span class="co">#  edge_colors[to_idx, from_idx] &lt;- edge_colors[from_idx, to_idx]</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>            <span class="co">#}</span></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the diagram</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    diagram <span class="ot">&lt;-</span> <span class="fu">qgraph</span>(adj_matrix,</span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> var_names,</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>                      <span class="at">edge.labels =</span> edge_labels,</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>                      <span class="at">layout =</span> layout_matrix,</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>                      <span class="at">groups =</span> <span class="fu">list</span>(<span class="at">latent =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(latent_vars),</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">manifest =</span> (<span class="fu">length</span>(latent_vars) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n_vars),</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>                      <span class="at">directed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>                      <span class="at">shape =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"circle"</span>, <span class="fu">length</span>(latent_vars)),</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="st">"rectangle"</span>, <span class="fu">length</span>(manifest_vars))),</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label.scale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>                      <span class="at">edge.label.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label.cex =</span> <span class="fl">0.9</span>,</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>                      <span class="at">edge.width =</span> <span class="dv">1</span>,</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>                      <span class="at">borders =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>                      <span class="at">vsize =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">12</span>, <span class="fu">rep</span>(<span class="dv">15</span>, <span class="dv">8</span>)),  <span class="co"># Larger latent variables</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"lightgreen"</span>, <span class="fu">rep</span>(<span class="st">"white"</span>, <span class="dv">8</span>)),</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>                      <span class="at">height =</span> <span class="dv">10</span>,</span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>                      <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>                      <span class="at">legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>                      <span class="at">edge.color =</span> edge_colors,</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>                      <span class="at">residuals =</span> <span class="cn">FALSE</span>,  <span class="co"># Explicitly disable residuals</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bifactor =</span> <span class="cn">FALSE</span>)   <span class="co"># Disable bifactor structure</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">fits =</span> model_fits,</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">comparison =</span> comparison,</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_differences =</span> model_diffs,</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    <span class="at">loadings =</span> loadings,</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>    <span class="at">correlation =</span> correlation,</span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagram =</span> diagram</span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the analysis with your data</span></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">run_measurement_invariance</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-invtest" class="quarto-float quarto-figure quarto-figure-center" prefix="" data-fignum="1">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-invtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Figure&nbsp;1</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Factorial Invariance Tests for Happiness and Purpose Measures Across Timepoints</p>
</div>
</figcaption>
<div aria-describedby="fig-invtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Purpose-Happiness-JOPP_files/figure-html/fig-invtest-1.svg" class="img-fluid figure-img" width="624">
</div>
</figure>
</div>
</div>
</div>
<div class="cell FigureWithoutNote" data-custom-style="FigureWithoutNote">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a visualization of the cross-lagged panel model using ggplot2</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract standardized coefficients from param_est</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll use the values calculated earlier in the document</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>a1_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"a1"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>a2_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"a2"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>b1_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"b1"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>b2_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"b2"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>c1_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"c1"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>c2_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"c2"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>d1_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"d1"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>d2_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, param_est[param_est<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"d2"</span>, <span class="st">"std.all"</span>])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>e1_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, correlations<span class="sc">$</span>est.std[<span class="dv">1</span>])</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>e2_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, correlations<span class="sc">$</span>est.std[<span class="dv">2</span>])</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>e3_value <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, correlations<span class="sc">$</span>est.std[<span class="dv">3</span>])</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create basic plot</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">6</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add time point indicators</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>), <span class="at">y =</span> <span class="fl">5.5</span>, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Time 1 (Baseline)"</span>, <span class="st">"Time 2 (Follow-up 1)"</span>, <span class="st">"Time 3 (Follow-up 2)"</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes for variables</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Happiness nodes</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline happiness</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">1.5</span>, <span class="at">xmax =</span> <span class="fl">2.5</span>, <span class="at">ymin =</span> <span class="dv">4</span>, <span class="at">ymax =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="fl">4.5</span>, <span class="at">label =</span> <span class="st">"Happiness"</span>, <span class="at">size =</span> <span class="fl">2.6</span>) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Follow-up 1 happiness</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">4.5</span>, <span class="at">xmax =</span> <span class="fl">5.5</span>, <span class="at">ymin =</span> <span class="dv">4</span>, <span class="at">ymax =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="fl">4.5</span>, <span class="at">label =</span> <span class="st">"Happiness"</span>, <span class="at">size =</span> <span class="fl">2.6</span>) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Follow-up 2 happiness</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">7.5</span>, <span class="at">xmax =</span> <span class="fl">8.5</span>, <span class="at">ymin =</span> <span class="dv">4</span>, <span class="at">ymax =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fl">4.5</span>, <span class="at">label =</span> <span class="st">"Happiness"</span>, <span class="at">size =</span> <span class="fl">2.6</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose nodes</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline purpose</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">1.5</span>, <span class="at">xmax =</span> <span class="fl">2.5</span>, <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">"Purpose"</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Follow-up 1 purpose</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">4.5</span>, <span class="at">xmax =</span> <span class="fl">5.5</span>, <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">"Purpose"</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Follow-up 2 purpose</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">7.5</span>, <span class="at">xmax =</span> <span class="fl">8.5</span>, <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">"Purpose"</span>, <span class="at">size =</span> <span class="fl">3.5</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add arrows for auto-regressive paths</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Happiness auto-regressive paths</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T1 to T2 happiness</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="fl">4.5</span>, <span class="at">y =</span> <span class="fl">4.5</span>, <span class="at">yend =</span> <span class="fl">4.5</span>, </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="fl">4.7</span>, <span class="at">label =</span> a1_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T2 to T3 happiness</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">5.5</span>, <span class="at">xend =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="fl">4.5</span>, <span class="at">yend =</span> <span class="fl">4.5</span>,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">6.5</span>, <span class="at">y =</span> <span class="fl">4.7</span>, <span class="at">label =</span> a2_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose auto-regressive paths</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T1 to T2 purpose</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="fl">4.5</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">yend =</span> <span class="fl">1.5</span>, </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="fl">1.7</span>, <span class="at">label =</span> b1_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T2 to T3 purpose</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">5.5</span>, <span class="at">xend =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">yend =</span> <span class="fl">1.5</span>,</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">6.5</span>, <span class="at">y =</span> <span class="fl">1.7</span>, <span class="at">label =</span> b2_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cross-lagged paths</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Happiness to Purpose (c paths)</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T1 happiness to T2 purpose</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="fl">4.5</span>, <span class="at">y =</span> <span class="fl">4.3</span>, <span class="at">yend =</span> <span class="fl">1.7</span>, </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="fl">3.6</span>, <span class="at">label =</span> c1_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T2 happiness to T3 purpose</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">5.5</span>, <span class="at">xend =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="fl">4.3</span>, <span class="at">yend =</span> <span class="fl">1.7</span>,</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">6.5</span>, <span class="at">y =</span> <span class="fl">3.6</span>, <span class="at">label =</span> c2_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose to Happiness (d paths)</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T1 purpose to T2 happiness</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="fl">4.5</span>, <span class="at">y =</span> <span class="fl">1.7</span>, <span class="at">yend =</span> <span class="fl">4.3</span>, </span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="fl">2.6</span>, <span class="at">label =</span> d1_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># T2 purpose to T3 happiness</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">5.5</span>, <span class="at">xend =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="fl">1.7</span>, <span class="at">yend =</span> <span class="fl">4.3</span>,</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">6.5</span>, <span class="at">y =</span> <span class="fl">2.6</span>, <span class="at">label =</span> d2_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Add covariance double-headed arrows (within each time point)</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw curved lines for covariances with double-headed arrows</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="co"># For T1</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"curve"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">4</span>, <span class="at">yend =</span> <span class="dv">2</span>, </span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>           <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">ends =</span> <span class="st">"both"</span>), </span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.3</span>, <span class="at">y =</span> <span class="dv">3</span>, <span class="at">label =</span> e1_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>)</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="co"># For T2</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"curve"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">xend =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="dv">4</span>, <span class="at">yend =</span> <span class="dv">2</span>, </span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>           <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">ends =</span> <span class="st">"both"</span>), </span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">4.3</span>, <span class="at">y =</span> <span class="dv">3</span>, <span class="at">label =</span> e2_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>)</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="co"># For T3</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"curve"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">xend =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">4</span>, <span class="at">yend =</span> <span class="dv">2</span>, </span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>           <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">ends =</span> <span class="st">"both"</span>), </span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">7.3</span>, <span class="at">y =</span> <span class="dv">3</span>, <span class="at">label =</span> e3_value, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a small note at the bottom to explain colors (instead of a full legend)</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> </span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="fl">0.3</span>, </span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Note: Black = stability paths,"</span>,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Red = Happiness → Purpose,"</span>,</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Blue = Purpose → Happiness,"</span>,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Grey = Correlations"</span>),</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">2.8</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Display just one instance of the plot</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-clpm" class="quarto-float quarto-figure quarto-figure-center" prefix="" data-fignum="2">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-clpm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Figure&nbsp;2</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Cross-Lagged Panel Model of Purpose and Happiness with Standardized Path Coefficients</p>
</div>
</figcaption>
<div aria-describedby="fig-clpm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Purpose-Happiness-JOPP_files/figure-html/fig-clpm-1.svg" class="img-fluid figure-img" style="width:100.0%">
</div>
</figure>
</div>
</div>
</div>
<div id="fig-quantile" class="quarto-layout-panel FigureWithoutNote" data-custom-style="FigureWithoutNote">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-quantile-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
<div aria-describedby="fig-quantile-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p>Quantile Regression Analysis of Purpose and Happiness</p>
</div>
</div>
</div>
</figure>
</div>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-aghababaei2014does" class="csl-entry" role="listitem">
Aghababaei, N., &amp; Błachnio, A. (2014). Does purpose in life predict subjective happiness - the mediating role of basic psychological needs. <em>Journal of Happiness Studies</em>, <em>15</em>(3), 459–474.
</div>
<div id="ref-andrews1980measures" class="csl-entry" role="listitem">
Andrews, F. M., &amp; McKennell, A. C. (1980). Measures of self-reported well-being: Their affective, cognitive, and other components. <em>Social Indicators Research</em>, <em>8</em>, 127–155.
</div>
<div id="ref-baumeister2013some" class="csl-entry" role="listitem">
Baumeister, R. F., Vohs, K. D., Aaker, J. L., &amp; Garbinsky, E. N. (2013). Some key differences between a happy life and a meaningful life. <em>Journal of Positive Psychology</em>, <em>8</em>, 505–516.
</div>
<div id="ref-busseri2011review" class="csl-entry" role="listitem">
Busseri, M. A., &amp; Sadava, S. W. (2011). A review of the tripartite structure of subjective well-being: Implications for conceptualization, operationalization, analysis, and synthesis. <em>Personality and Social Psychology Review</em>, <em>15</em>(3), 290–314.
</div>
<div id="ref-chen2020role" class="csl-entry" role="listitem">
Chen, C.-T., &amp; Cheng, Y.-Y. (2020). The role of hope and grit in life satisfaction and school adjustment among second-chance alternative school students in taiwan. <em>International Journal of Environmental Research and Public Health</em>, <em>17</em>(3), 889.
</div>
<div id="ref-choi2023happiness" class="csl-entry" role="listitem">
Choi, H., Diener, E., Sim, J. H., &amp; Oishi, S. (2023). Happiness is associated with successful living across cultures. <em>The Journal of Positive Psychology</em>, <em>18</em>(6), 958–977.
</div>
<div id="ref-cohen2010best" class="csl-entry" role="listitem">
Cohen, P., Cohen, J., Aiken, L. S., &amp; West, S. G. (2010). Best practices in quantitative methods for developmentalists. <em>Monographs of the Society for Research in Child Development</em>, <em>75</em>(1), 1–217.
</div>
<div id="ref-bronk2009purpose" class="csl-entry" role="listitem">
Cotton Bronk, K., Hill, P. L., Lapsley, D. K., Talib, T. L., &amp; Finch, H. (2009). Purpose, hope, and life satisfaction in three age groups. <em>The Journal of Positive Psychology</em>, <em>4</em>(6), 500–510.
</div>
<div id="ref-coyne2013highly" class="csl-entry" role="listitem">
Coyne, J. C. (2013). Highly correlated hedonic and eudaimonic well-being thwart genomic analysis. <em>Proceedings of the National Academy of Sciences</em>, <em>110</em>(45), E4183–E4183.
</div>
<div id="ref-crego2021meaning" class="csl-entry" role="listitem">
Crego, A., Yela, J. R., Gómez-Martínez, M. A., &amp; Karim, A. A. M. (2021). Meaning in life among adolescents: Factorial invariance of the purpose in life test and associations with personality traits and schemas. <em>Journal of Happiness Studies</em>, <em>22</em>, 1359–1377.
</div>
<div id="ref-damon2003development" class="csl-entry" role="listitem">
Damon, W., Menon, J., &amp; Cotton Bronk, K. (2003). The development of purpose during adolescence. <em>Applied Developmental Science</em>, <em>7</em>(3), 119–128.
</div>
<div id="ref-diener1984subjective" class="csl-entry" role="listitem">
Diener, E. (1984). Subjective well-being. <em>Psychological Bulletin</em>, <em>95</em>(3), 542.
</div>
<div id="ref-diener2006guidelines" class="csl-entry" role="listitem">
Diener, E. (2006). Guidelines for national indicators of subjective well-being and ill-being. <em>Applied Research in Quality of Life</em>, <em>1</em>(2), 151–157.
</div>
<div id="ref-diener2009prosperity" class="csl-entry" role="listitem">
Diener, E., Lucas, R. E., Schimmack, U., &amp; Helliwell, J. F. (2009). Prosperity, happiness, and public policy. <em>Happiness Is the Measure of True Wealth</em>.
</div>
<div id="ref-disabato2025wellbeing" class="csl-entry" role="listitem">
Disabato, D., Goodman, F., &amp; Kashdan, T. B. (2025). The experience of personally valued fulfillment within one’s life. <em>Psychological Review</em>.
</div>
<div id="ref-duckworth2010establishing" class="csl-entry" role="listitem">
Duckworth, A. L., Tsukayama, E., &amp; May, H. (2010). Establishing causality using longitudinal hierarchical linear modeling: An illustration predicting achievement from self-control. <em>Social Psychological and Personality Science</em>, <em>1</em>(4), 311–317.
</div>
<div id="ref-extremera2011trait" class="csl-entry" role="listitem">
Extremera, N., Salguero, J. M., &amp; Fernández-Berrocal, P. (2011). Trait meta-mood and subjective happiness: A 7-week prospective study. <em>Journal of Happiness Studies</em>, <em>12</em>(3), 509–517.
</div>
<div id="ref-fogelman2015role" class="csl-entry" role="listitem">
Fogelman, N., &amp; Canli, T. (2015). The role of purpose in life in the relationship between cortisol and subjective well-being. <em>Psychosomatic Medicine</em>, <em>77</em>(5), 508–516.
</div>
<div id="ref-frankl1959mans" class="csl-entry" role="listitem">
Frankl, V. E. (1959). <em>Man’s search for meaning</em>. Beacon Press.
</div>
<div id="ref-hill2024beating" class="csl-entry" role="listitem">
Hill, P. L., Beatty, A. L., &amp; Wolk, D. A. (2024). Beating the odds: Purpose in life protects against dementia among individuals with high genetic risk. <em>Psychological Science</em>.
</div>
<div id="ref-hill2010sense" class="csl-entry" role="listitem">
Hill, P. L., Burrow, A. L., O’Dell, A. C., &amp; Thornton, M. A. (2010). A sense of calling: Finding meaning in generative concerns. <em>International Journal of Developmental Science</em>, <em>4</em>(1), 1–8.
</div>
<div id="ref-hill2016assessing" class="csl-entry" role="listitem">
Hill, P. L., Edmonds, G. W., Peterson, M., Luyckx, K., &amp; Andrews, J. A. (2016). Assessing the validity of abbreviated versions of the intentions to help others scale. <em>European Journal of Psychological Assessment</em>.
</div>
<div id="ref-hill2019parent" class="csl-entry" role="listitem">
Hill, P. L., Schultz, L. H., Jackson, J. J., &amp; Andrews, J. A. (2019). Parent-child conflict during elementary school as a longitudinal predictor of sense of purpose in emerging adulthood. <em>Journal of Youth and Adolescence</em>, <em>48</em>, 145–153.
</div>
<div id="ref-hill2018sense" class="csl-entry" role="listitem">
Hill, P. L., Sin, N. L., Turiano, N. A., Burrow, A. L., &amp; Almeida, D. M. (2018). Sense of purpose in life and five health behaviors in older adults. <em>Preventive Medicine</em>, <em>107</em>, 63–68.
</div>
<div id="ref-iasiello2024map" class="csl-entry" role="listitem">
Iasiello, M., Bartholomaeus, J., Jarden, A., Kelly, G., &amp; Agteren, J. van. (2024). A map of positive mental health instruments and their 410 dimensions. <em>Journal of Personality Assessment</em>, 1–15.
</div>
<div id="ref-jovanovic2024cross" class="csl-entry" role="listitem">
Jovanović, V., Rudnev, M., Aryanto, C. B., Balgiu, B. A., Caudek, C., Datu, J. A. D., et al. (2024). A cross-cultural evaluation of diener’s tripartite model of subjective well-being across 16 countries. <em>Journal of Happiness Studies</em>, <em>25</em>(6), 82.
</div>
<div id="ref-kahneman1999well" class="csl-entry" role="listitem">
Kahneman, D., Diener, E., &amp; Schwarz, N. (1999). <em>Well-being: Foundations of hedonic psychology</em>. Russell Sage Foundation.
</div>
<div id="ref-kashdan2008reconsidering" class="csl-entry" role="listitem">
Kashdan, T. B., Biswas-Diener, R., &amp; King, L. A. (2008). Reconsidering happiness: The costs of distinguishing between hedonics and eudaimonia. <em>The Journal of Positive Psychology</em>, <em>3</em>(4), 219–233.
</div>
<div id="ref-kashdan2024purpose" class="csl-entry" role="listitem">
Kashdan, T. B., Goodman, F. R., McKnight, P. E., Brown, B., &amp; Rum, R. (2024). Purpose in life: A resolution on the definition, conceptual model, and optimal measurement. <em>American Psychologist</em>, <em>79</em>(6), 838–853.
</div>
<div id="ref-kern2015multidimensional" class="csl-entry" role="listitem">
Kern, M. L., Waters, L. E., Adler, A., &amp; White, M. A. (2015). A multidimensional approach to measuring well-being in students: Application of the PERMA framework. <em>The Journal of Positive Psychology</em>, <em>10</em>(3), 262–271.
</div>
<div id="ref-kim2019sense" class="csl-entry" role="listitem">
Kim, E. S., Delaney, S. W., &amp; Kubzansky, L. D. (2019). Sense of purpose in life and cardiovascular disease: Underlying mechanisms and future directions. <em>Current Cardiology Reports</em>, <em>21</em>, 1–11.
</div>
<div id="ref-kim2017associations" class="csl-entry" role="listitem">
Kim, J., Kim, H., &amp; Jeon, D. (2017). Associations between meaning in life, psychological well-being, and life satisfaction. <em>The Korean Journal of Psychology: General</em>, <em>36</em>(3), 325–344.
</div>
<div id="ref-kosine2008purpose" class="csl-entry" role="listitem">
Kosine, N. R., Steger, M. F., &amp; Duncan, S. (2008). Purpose-centered career development: A strengths-based approach to finding meaning and purpose in careers. <em>Professional School Counseling</em>, <em>12</em>(2), 133–136.
</div>
<div id="ref-lucas2007adaptation" class="csl-entry" role="listitem">
Lucas, R. E. (2007). Adaptation and the set-point model of subjective well-being: Does happiness change after major life events? <em>Current Directions in Psychological Science</em>, <em>16</em>(2), 75–79.
</div>
<div id="ref-lyubomirsky1999measure" class="csl-entry" role="listitem">
Lyubomirsky, S., &amp; Lepper, H. S. (1999). A measure of subjective happiness: Preliminary reliability and construct validation. <em>Social Indicators Research</em>, <em>46</em>, 137–155.
</div>
<div id="ref-mcknight2009purpose" class="csl-entry" role="listitem">
McKnight, P. E., &amp; Kashdan, T. B. (2009b). Purpose in life as a system that creates and sustains health and well-being: An integrative, testable theory. <em>Review of General Psychology</em>, <em>13</em>(3), 242–251.
</div>
<div id="ref-mcknight2009" class="csl-entry" role="listitem">
McKnight, P. E., &amp; Kashdan, T. B. (2009a). Purpose in life as a system that creates and sustains health and well-being: An integrative, testable theory. <em>Review of General Psychology</em>, <em>13</em>(3), 242–251. <a href="https://doi.org/10.1037/a0017152">https://doi.org/10.1037/a0017152</a>
</div>
<div id="ref-medvedev2018exploring" class="csl-entry" role="listitem">
Medvedev, O. N., &amp; Landhuis, C. E. (2018). Exploring constructs of well-being, happiness and quality of life. <em>PeerJ</em>, <em>6</em>, e4903.
</div>
<div id="ref-pfund2018multifaceted" class="csl-entry" role="listitem">
Pfund, G. N., &amp; Hill, P. L. (2018). The multifaceted benefits of purpose in life. <em>The International Forum for Logotherapy</em>, <em>41</em>, 27–37.
</div>
<div id="ref-base" class="csl-entry" role="listitem">
R Core Team. (2025). <em>R: A language and environment for statistical computing</em>. <a href="https://www.R-project.org/">https://www.R-project.org/</a>
</div>
<div id="ref-robak2000purpose" class="csl-entry" role="listitem">
Robak, R. W., &amp; Griffin, P. W. (2000). Purpose in life: What is its relationship to happiness, depression, and grieving? <em>North American Journal of Psychology</em>, <em>2</em>(1), 113–120.
</div>
<div id="ref-rogosa1980critique" class="csl-entry" role="listitem">
Rogosa, D. (1980). A critique of cross-lagged correlation. <em>Psychological Bulletin</em>, <em>88</em>(2), 245.
</div>
<div id="ref-rottenberg2022well" class="csl-entry" role="listitem">
Rottenberg, J., &amp; Kashdan, T. B. (2022). Well-being after psychopathology: A transformational research agenda. <em>Current Directions in Psychological Science</em>, <em>31</em>(3), 280–287.
</div>
<div id="ref-ryff1989happiness" class="csl-entry" role="listitem">
Ryff, C. D. (1989). Happiness is everything, or is it? Explorations on the meaning of psychological well-being. <em>Journal of Personality and Social Psychology</em>, <em>57</em>(6), 1069.
</div>
<div id="ref-ryff1995psychological" class="csl-entry" role="listitem">
Ryff, C. D. (1995). Psychological well-being in adult life. <em>Current Directions in Psychological Science</em>, <em>4</em>(4), 99–104.
</div>
<div id="ref-schaefer2013purpose" class="csl-entry" role="listitem">
Schaefer, S. M., Boylan, J. M., Van Reekum, C. M., Lapate, R. C., Norris, C. J., Ryff, C. D., &amp; Davidson, R. J. (2013). Purpose in life predicts better emotional recovery from negative stimuli. <em>PloS One</em>, <em>8</em>(11), e80329.
</div>
<div id="ref-sheldon2007possible" class="csl-entry" role="listitem">
Sheldon, K. M., &amp; Lyubomirsky, S. (2007). Is it possible to become happier?(and if so, how?). <em>Social and Personality Psychology Compass</em>, <em>1</em>(1), 129–145.
</div>
<div id="ref-sheldon2015experiential" class="csl-entry" role="listitem">
Sheldon, K. M., Prentice, M., &amp; Halusic, M. (2015). The experiential incompatibility of mindfulness and flow absorption. <em>Social Psychological and Personality Science</em>, <em>6</em>(3), 276–283.
</div>
<div id="ref-thalmayer2024lifespan" class="csl-entry" role="listitem">
Thalmayer, A. G., Asatsa, S., Shino, E. N., Naudé, L., Laher, S., Hassem, T., et al. (2024). Lifespan research in kenya, namibia, and south africa: Cohort profile of the africa long life study. <em>Personality Science</em>, <em>5</em>, 27000710241264492.
</div>
<div id="ref-vandenbergReviewSynthesisMeasurement2000" class="csl-entry" role="listitem">
Vandenberg, R. J., &amp; Lance, C. E. (2000). A Review and Synthesis of the Measurement Invariance Literature: Suggestions, Practices, and Recommendations for Organizational Research. <em>Organizational Research Methods</em>, <em>3</em>(1), 4–70. <a href="https://doi.org/10.1177/109442810031002">https://doi.org/10.1177/109442810031002</a>
</div>
<div id="ref-vanderweele2017promotion" class="csl-entry" role="listitem">
VanderWeele, T. J. (2017). On the promotion of human flourishing. <em>Proceedings of the National Academy of Sciences</em>, <em>114</em>(31), 8148–8156.
</div>
<div id="ref-veenhoven2008healthy" class="csl-entry" role="listitem">
Veenhoven, R. (2008). Healthy happiness: Effects of happiness on physical health and the consequences for preventive health care. <em>Journal of Happiness Studies</em>, <em>9</em>, 449–469.
</div>
<div id="ref-vittterso2025happiness" class="csl-entry" role="listitem">
Vittersø, J. (2025). Happiness and wellbeing. In <em>Humanistic wellbeing: Toward a value-based science of the good life</em> (pp. 49–77). Springer Nature Switzerland.
</div>
<div id="ref-walters2010" class="csl-entry" role="listitem">
Walters, K. (2010). Attentional biases in social anxiety: An investigation of rumination. <em>Theses and Dissertations (Comprehensive)</em>. <a href="http://scholars.wlu.ca/etd/977">http://scholars.wlu.ca/etd/977</a>
</div>
<div id="ref-yue2014humor" class="csl-entry" role="listitem">
Yue, X. D., Liu, K. W., Jiang, F., &amp; Hiranandani, N. A. (2014). Humor styles, self-esteem, and subjective happiness. <em>Psychological Reports</em>, <em>115</em>(2), 517–525.
</div>
<div id="ref-zager2022measurement" class="csl-entry" role="listitem">
Zager Kocjan, G., Jose, P. E., Sočan, G., &amp; Avsec, A. (2022). Measurement invariance of the subjective happiness scale across countries, gender, age, and time. <em>Assessment</em>, <em>29</em>(4), 826–841.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>